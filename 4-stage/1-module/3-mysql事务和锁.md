> 第三部分 MySQL事务和锁

# 1 ACID 特性

[InnoDB and the ACID Model](https://dev.mysql.com/doc/refman/5.7/en/mysql-acid.html)

在关系型数据库管理系统中，一个逻辑工作单元要完成事务，必须满足这 4 个特性，即所谓的 ACID：Atomicity、Consistency、Isolation、Durability。

## 1.1 原子性

原子性：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全不执行。

修改 ---> Buffer Pool 修改 ---> 刷盘。可能有下面两种情况：

- 事务提交了，如果此时 Buffer Pool 的脏页没有刷盘，如何保证修改的数据生效？Redo
- 如果事务没提交，但是Bufer Pool 的脏页刷盘了，如何保证不该存在的数据撤销？Undo

每一个写事务，都会修改 Buffer Pool，从而产生相应的 Redo/Undo 日志，在 Buffer Pool 中的也被刷到磁盘之前，这些日志信息都会先写入到日志文件中，如果 Buffer Pool 中的脏页没有刷成功，此时数据库挂了，那再数据库再次启动之后，可以通过 Redo 日志将其恢复出来，以保证脏页写的数据不会丢失。如果脏页刷新成功，此时数据库挂了，就需要通过 Undo 来实现了。

## 1.2 持久性

持久性：指的是一个事务一旦提交，它对数据库中数据的改变就应该是永久的，后续的操作或故障不应该对其有任何影响，不会丢失。

MySQL 的持久性 也与 **WAL** 技术相关，redo log 在系统 Crash 重启之类的情况时，可以修复数据，从而保障事务的持久性。通过原子性可以保证逻辑上的持久性，通过存储引擎的数据刷盘可以保证物理上的持久性。

## 1.3 隔离性

隔离性：指的是一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对其他的并发事务是隔离的。

InnoDB 支持的隔离性有 4 种，隔离性从低到高分别为：读未提交、读提交、可重复读、可串行化。锁和多版本控制（MVCC）技术就是用于保障隔离性的。



# 2 事务控制的演进

# 3 事务隔离级别

# 4 锁机制和实战