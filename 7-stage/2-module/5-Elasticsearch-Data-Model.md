第五部分 Elasticsearch数据模型构建

# 1 什么时数据模型

数据建模是抽象描述现实世界的一种工具和方法，是通过抽象实体及实体之间联系的形式，用图形化的形式去描述业务规则的过程，从而表示现实世界中事物以及相互关系的一种映射。

核心概念：

1. 实体：现实世界中存在的可以相互区分的事物或概念成为实体。

   实体可以分为事物实体和概念实体。例如：一个学生是事物实体。一门课、一个班级等称为概念实体。

2. 实体属性：每个实体都有自己的特征，利用实体的属性可以描述不同的实体。例如：学生实体的属性为姓名、性别、年龄等。

# 2 数据建模的过程

数据建模大致分为三个阶段，概念建模阶段，逻辑建模阶段和物理建模阶段。

1. 概念建模阶段

   主要做三件事：

   - 客户交流
   - 理解需求
   - 形成实体

   确定系统的核心需求和范围边界，设计实体与实体之间的关系。

   在概念建模阶段，只需要关注实体即可，不用关注任何实现细节，很多人希望在这个节点把具体表结构，索引，约束，甚至是存储过程都想好，没必要！因为这些东西是我们在物理建模阶段需要考虑的东西。概念模式在整个数据建模时间占比：10%左右。

2. 逻辑建模阶段

   主要做两件事：

   - 进一步梳理业务需求
   - 确定每个实体的属性、关系和约束等

   逻辑模式是对概念模式的进一步分解和细化，描述了实体、实体属性以及实体之间的关系，是概念模型延申，一半的逻辑模型有第三范式，星型模型和雪花模型。模型的主要元素为主题、实体、实体属性和关系。

   雪花模型和星状模型的主要区别是维度的层级，标准的星状模型只有一层，而雪花模型可能涉及多层。

   逻辑模型的作用主要有两点：

   - 一是 便于技术开发人员和业务人员以及用户进行沟通交流，使得整个概念模型更易于理解，进一步明确需求。
   - 二是作为物理涉及的基础，由于逻辑模型不依赖于具体的数据库实现，使用逻辑模型可以生成针对具体数据库管理系统的物理模型，保证物理模型充分满足用户的需求。

   逻辑模型在整个数据建模时间占比：60-70%左右。

3. 物理建模阶段

   主要做一件事：

   结合具体的数据产品（mysql/oracle/mongo/elasticsearch），在满足业务读写性能等需求的前提下确定最终的定义。

   物理模式是在逻辑模型的基础上描述模型实体的细节，包括数据产品对应的数据类型、长度、索引等因素，为逻辑模型选择一个最有的物理存储环境。

   逻辑模型转化为物理模型的过程也就是实体名转化为表名，属性名转化为物理列名的过程。

   在设计物理模型时，还需要考虑数据存储空间的分配，包括对列属性必须做出明确的定义。

   ```
   例如：客户姓名的数据类型是varchar2，长度是20，存储在Oracle数据库中，并且建立索引用于提高该字段的查询效率。
   物理模型在整个数据建模时间占比：20—30%左右。
   ```

   

# 3 数据建模的意义

# 4 ES数据建模Mapping设置

## 4.1 ES Mapping 属性

## 4.2 ES Mapping字段设置流程图

## 4.3 ES Mapping样例

# 5 ES关联关系处理

