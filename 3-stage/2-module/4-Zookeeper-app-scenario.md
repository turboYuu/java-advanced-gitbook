> 第四部分 Zookeeper应用场景

Zookeeper 是一个典型的 发布/订阅 模式的分布式数据管理与协调框架，我们可以使用它来进行分布式数据的发布 与 订阅。另一方面，通过对 Zookeeper 中丰富的数据节点类型进行交叉使用，配合 Watcher 事件通知机制，可以非常简单的构建一系列分布式应用中都会涉及的核心功能，如 **数据发布/订阅**、**命名服务**、**集群管理**、**Master选举**、**分布式锁** 和 **分布式队列** 等。那接下来就针对这些典型的分布式应用场景来做介绍。

# 1 数据发布/订阅

数据发布/订阅（Public/Subscribe）系统，即所谓的配置中心，顾名思义就是发布者将数据发布到 Zookeeper 的一个或一些列节点上，共订阅者进行数据订阅，进而达到动态获取数据的目的，实现配置信息的集中式管理和数据的动态更新。

发布/订阅系统一般有两种设计模式，分别是 **推(Push)** 模式 和 **拉(Pull)** 模式。在推模式中，服务端主动将数据更新发送给所有订阅的客户端；而 拉模式 则是由客户端主动发起请求来获取最新数据，通常客户端都采用定时轮询拉取的方式。

Zookeeper 采用的是推拉相结合的方式：客户端向服务端注册自己需要关注的节点，一旦该节点的数据发生变更，那么服务端就会向相应的客户端发送 Watcher 事件通知，客户端接收到这个消息通知之后，需要主动到服务端获取最新的数据。

如果将配置信息存放到 Zookeeper 上进行集中管理，那么通常情况下，应用在启动的时候都会主动到 Zookeeper 服务端上进行一次配置信息的获取。同时，在指定节点上注册一个 Watcher 监听，这样一来，但凡配置信息发生变更，服务端会实时通知到所有订阅的客户端，从而达到实时获取最新配置信息的目的。



# 2 命名服务

命名服务（Name Service）也是分布式系统中比较常见的一类场景，是分布式系统最基本的公共服务之一。在分布式系统中，被命名的实体通常可以是集群中的机器、提供的服务地址或远程对象等——这些我们都可以统称它们为名字。

分布式全局唯一 ID 生成 ：

通过调用 Zookeeper 节点创建的 API 接口可以创建一个顺序节点，并且在 API 返回值中返回这个节点的完整名字。利用这个特性，我们可以借助 Zookeeper 来生成全局唯一的 ID。



# 3 集群管理

# 4 Master选举

# 5 分布式锁

## 5.1 排他锁

## 5.2 共享锁

## 5.3 羊群效应

# 6 分布式队列