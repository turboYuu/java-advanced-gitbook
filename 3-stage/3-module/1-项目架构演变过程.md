> 第一部分 项目架构演变过程

# 1 单体架构

单体架构所有模块和功能都集中在一个项目中，部署时也是将项目所有功能整体部署到服务器中。

![image-20220726111528069](assest/image-20220726111528069.png)

- 优点
  - 小项目开发快，成本低
  - 架构简单
  - 易于测试
  - 易于部署
- 缺点
  - 大项目模块耦合严重，不易开发，维护，沟通成本高
  - 新增业务困难
  - 核心业务与边缘业务混合在一块，出现问题互相影响

# 2 垂直架构

根据业务把项目垂直切割成多个项目，因此这种架构称之为垂直架构。

为了避免上面提到的那些问题，我们开始做模块的垂直划分，做垂直划分的原则是基于项目的业务特性，核心目标。第一个是为了业务之间互不影响，第二个是在研发团队的壮大后为了提高效率，减少之间的依赖。

![image-20220726123521657](assest/image-20220726123521657.png)

- 优点
  - 系统拆分实现流量分担，解决了并发问题
  - 可以针对不同系统进行优化
  - 方便水平扩展，负载均衡，容错率提高
  - 系统间相互独立，互不影响，新的业务迭代时更加高效
- 缺点
  - 服务系统之间接口调用硬编码
  - 搭建集群之后，实现负载均衡比较复杂
  - 服务系统接口调用监控不到位，调用方式不统一
  - 服务监控不到位
  - 数据库资源浪费，充斥慢查询，主从同步延迟大

# 3 分布式架构（SOA）

SOA 全称 Service Oriented Architecture，即面向服务的架构。它是在垂直划分的基础上，将每个项目拆分出多个具备松耦合的服务，一个服务通常以独立的形式存在于操作系统进程中。各个服务之间通过网络调用，这使得构建在各种各样的系统中的服务可以 以一种 统一 和 通用的方式进行交互。

做了垂直划分以后，模块随之增多，系统之间的 RPC 逐渐增多，维护成本越来越高，一些通用的业务和模块重复的也越来越多。这个时候上面提到的接口协议不统一，服务无法监控，服务的负载均衡等问题更加突出，为了解决上面的这些问题，我们将通用的业务逻辑下沉到服务层，通过接口暴露，共其他业务场景调用。同时引入了 阿里巴巴 开源的 [Dubbo]()，一款高性能、轻量级的开源 Java RPC 框架，他提供了三大核心能力：**面向接口的远程方法调用**，**智能容错和负载均衡** 以及 **服务自动注册和发现**。



优点

- 服务以接口为粒度，为开发者屏蔽远程调用的底层细节，使用 Dubbo 面向接口远程方法调用屏蔽了底层调用细节。
- 业务分层以后 结构更加清晰，并且每个业务模块职责单一，扩展性更强。
- 数据隔离，权限回收，数据访问都通过接口，让系统更加稳定 安全。
- 服务应用本身无状态话。这里的无状态化指的是应用本身不做内存级缓存，而是把数据存储 DB。
- 服务责任易确定。每个服务可以确定责任人，这样更容易保证服务质量和稳定。

缺点

- 粒度控制复杂。如果没有控制好服务的粒度，服务的模块就会越来越多，就会引发超时分布式事务等问题。
- 服务接口数量不宜控制。容易引发接口爆炸，所以服务接口建议以业务场景进行单位划分 并对相近的业务做抽象 防止接口爆炸。
- 版本升级兼容困难。尽量不要删除方法、字段、枚举类型的新增字段也可能不兼容。
- 调用链路长。服务质量不可监控，调用链路变长，下游抖动可能会影响到上游业务，最终形成连锁反应，服务质量不稳定，同时链路变长使得服务质量的监控变得困难。

# 4 微服务架构

微服务架构是一种将单个应用程序作为一套小型服务开发的方法，每种应用程序都在其自己的进程中独立运行，并使用轻量级机制（通常是 HTTP 资源的 API）进行通信。这些服务是围绕业务功能构建的，可以通过全自动部署机制进行独立部署。这些服务的集中化管理非常少，它们可以用不同的编程语言编写，并使用不同的数据存储技术。

微服务是在 SOA 上做的升华，粒度更加细致，微服务架构强调的一个重点是 “业务需要彻底的组件化 和 服务化”。

关于微服务架构的知识，后面 Spring Cloud 中会详细讲解。



# 5 集群、分布式、SOA、微服务的概念及区别

集群：不同服务器部署同一企应用服务对外提供访问，实现服务的负载均衡或者互备(热备，主从等)，指同一种组
件的多个实例，形成的逻镇上的整体。单个节点可以提供完整服务。**集群是物理形态**

分布式：服务的不同模块部署在不同的服务器上，单个节点不能提供完整服务，需要多节点协调提供服务(也可以
是相同组件部署在不同节点． 但节点间通过交换信息协作提供服务)，**分布式强调的是工作方式**

SOA：面向服务的架构，一种设计方法，其中包含多个服务，服务之间通过相互依赖最终提供一系列的功能。一个服务通常以独立的形式存在于操作系统进程中。各个服务之间通过网络调用。

- 中心化实现：
  ESB(企业服务总线)，各服务通过ESB进行交互，解决异构系统之间的连通性，通过协议转换、消
  息解析、消息路由把服务提供者的数据传送到服务消费者。很重，有一定的逻辑，可以解决一些公用逻辑的问
  题。
- 去中心化实现：微服务

微服务：在 SOA 上做的开华，微服务架构强调的一个重点是业务需要彻底的组件化和服务化，原有的单个业务系
统会拆分为多个可以独立开发．设计，运行的小应用。这些小应用之间通过服务完成交互和集成

服务单一职责
轻量级通信：去掉ESB总线来用 restful (PRC、restTemplate)通信





